{% extends "base.html" %}

{% block title %}{{ title }} - Workflow{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <div class="card-header">
                <h2 class="h4 mb-0">
                    <i data-feather="{{ 'edit' if project else 'plus' }}" class="me-2"></i>
                    {{ title }}
                </h2>
            </div>
            <div class="card-body">
                <form method="POST" novalidate>
                    <div class="mb-3">
                        <label for="title" class="form-label">Project Title *</label>
                        <input type="text" 
                               class="form-control" 
                               id="title" 
                               name="title" 
                               value="{{ (form_data.title if form_data else project.title if project else '') }}"
                               required
                               maxlength="200">
                        <div class="form-text">Choose a clear, descriptive title for your project</div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" 
                                  id="description" 
                                  name="description" 
                                  rows="4"
                                  maxlength="1000">{{ (form_data.description if form_data else project.description if project else '') }}</textarea>
                        <div class="form-text">Provide details about the project scope, requirements, or goals</div>
                    </div>

                    <div class="mb-3">
                        <label for="course" class="form-label">Course/Category</label>
                        <input type="text" 
                               class="form-control" 
                               id="course" 
                               name="course" 
                               value="{{ (form_data.course if form_data else project.course if project else '') }}"
                               maxlength="100"
                               list="course-suggestions">
                        <datalist id="course-suggestions">
                            <option value="Computer Science">
                            <option value="Mathematics">
                            <option value="Physics">
                            <option value="Chemistry">
                            <option value="Biology">
                            <option value="English Literature">
                            <option value="History">
                            <option value="Psychology">
                            <option value="Economics">
                            <option value="Engineering">
                        </datalist>
                        <div class="form-text">Specify the course or academic category for organization</div>
                    </div>

                    {% if project %}
                        <div class="mb-3">
                            <label for="status" class="form-label">Project Status</label>
                            <select class="form-select" id="status" name="status">
                                <option value="Not Started" {{ 'selected' if (form_data.status if form_data else project.status.value) == 'Not Started' }}>Not Started</option>
                                <option value="In Progress" {{ 'selected' if (form_data.status if form_data else project.status.value) == 'In Progress' }}>In Progress</option>
                                <option value="On Hold" {{ 'selected' if (form_data.status if form_data else project.status.value) == 'On Hold' }}>On Hold</option>
                                <option value="Completed" {{ 'selected' if (form_data.status if form_data else project.status.value) == 'Completed' }}>Completed</option>
                            </select>
                        </div>
                    {% endif %}

                    <div class="mb-3">
                        <label for="deadline" class="form-label">Deadline</label>
                        <input type="datetime-local" 
                               class="form-control" 
                               id="deadline" 
                               name="deadline" 
                               value="{{ (form_data.deadline if form_data else project.deadline.strftime('%Y-%m-%dT%H:%M') if project and project.deadline else '') }}">
                        <div class="form-text">Set a deadline to help track project timeline</div>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i data-feather="save" class="me-2"></i>
                            {{ 'Update Project' if project else 'Create Project' }}
                        </button>
                        <a href="{{ url_for('project_detail', project_id=project.id) if project else url_for('index') }}" 
                           class="btn btn-secondary">
                            <i data-feather="x" class="me-2"></i>
                            Cancel
                        </a>
                        {% if project %}
                            <button type="button" 
                                    class="btn btn-outline-danger ms-auto" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#deleteModal">
                                <i data-feather="trash-2" class="me-2"></i>
                                Delete Project
                            </button>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% if project %}
    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i data-feather="alert-triangle" class="me-2"></i>
                        Confirm Deletion
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete the project "<strong>{{ project.title }}</strong>"?</p>
                    <p class="text-muted mb-0">This action cannot be undone and will also delete all associated tasks.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <form method="POST" action="{{ url_for('delete_project', project_id=project.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger">
                            <i data-feather="trash-2" class="me-2"></i>
                            Delete Project
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Form validation
        const form = document.querySelector('form');
        const titleInput = document.getElementById('title');
        
        form.addEventListener('submit', function(e) {
            if (!titleInput.value.trim()) {
                e.preventDefault();
                titleInput.classList.add('is-invalid');
                titleInput.focus();
                
                // Remove invalid class after user starts typing
                titleInput.addEventListener('input', function() {
                    if (this.value.trim()) {
                        this.classList.remove('is-invalid');
                    }
                }, { once: true });
            }
        });
        
        // Auto-save to localStorage for draft protection
        const inputs = form.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            // Load saved value
            const savedValue = localStorage.getItem(`project_form_${input.name}`);
            if (savedValue && !input.value) {
                input.value = savedValue;
            }
            
            // Save on change
            input.addEventListener('change', function() {
                localStorage.setItem(`project_form_${input.name}`, input.value);
            });
        });
        
        // Clear localStorage on successful submit
        form.addEventListener('submit', function() {
            inputs.forEach(input => {
                localStorage.removeItem(`project_form_${input.name}`);
            });
        });
    });
</script>
{% endblock %}
